import{d as X,m as G,n as T,p as H,q as Q,c as b,a as n,e as t,s as z,t as O,w as l,r as i,u as r,F as I,x as N,f as d,y as Y,z as f,A as Z,h as m,B as ee,o as _,E as y,C as te,_ as le}from"./index-Bz0q8fqb.js";const ae={class:"batch-container"},se={class:"section-title"},oe={class:"title-actions"},ne={key:0,class:"upload-prompt"},re={key:1,class:"file-list-container"},ie={class:"file-list-header"},ue={class:"file-name"},ce={class:"filename-text"},de={class:"action-buttons"},pe={class:"progress-container"},fe={key:0,class:"status-actions"},me=X({__name:"Batch",setup(_e){const o=G(),v=T(null),u=T([]),p=H({targetLanguage:"",sourceLanguage:"",preserveFormatting:!0});try{let a=localStorage.getItem("TranslateOptions");a&&(a=JSON.parse(a),Object.assign(p,a))}catch(a){console.log(a)}const C=["中文","英文","日文","韩文","法文","德文","西班牙文","俄文"],E=Q(()=>(u.value.reduce((e,c)=>e+c.size,0)/(1024*1024)).toFixed(2)),P=a=>{const e=a.target;e.files&&e.files.length>0&&(u.value=[...u.value,...Array.from(e.files)])},R=a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer&&a.dataTransfer.files.length>0&&(u.value=[...u.value,...Array.from(a.dataTransfer.files)])},U=a=>{a.preventDefault(),a.stopPropagation()},$=a=>{u.value.splice(a,1)},w=()=>{u.value=[],v.value&&(v.value.value="")},j=async()=>{if(!p.targetLanguage){y.warning("请选择目标语言");return}if(u.value.length===0){y.warning("请先上传文件");return}localStorage.setItem("TranslateOptions",JSON.stringify(p));const a=te.service({lock:!0,text:"正在提交批量翻译任务...",background:"rgba(255, 255, 255, 0.7)"});try{const e=await o.translateBatch(u.value,p);y.success("批量翻译任务已提交，请在任务列表中查看进度"),w()}catch(e){y.error("提交批量翻译任务失败"),console.error(e)}finally{a.close()}},A=a=>{var c;switch(((c=a.split(".").pop())==null?void 0:c.toLowerCase())||""){case"txt":return m;case"md":return m;case"docx":return m;case"csv":return m;case"xlsx":return m;case"pdf":return m;case"srt":return ee;case"json":return m;default:return m}};return(a,e)=>{const c=i("el-button"),k=i("el-tooltip"),L=i("el-option"),V=i("el-select"),x=i("el-form-item"),J=i("el-checkbox"),M=i("el-form"),D=i("el-card"),F=i("el-icon"),S=i("el-table-column"),q=i("el-table"),B=i("el-tag"),h=i("el-descriptions-item"),K=i("el-descriptions"),W=i("el-progress");return _(),b("div",ae,[n("div",se,[e[7]||(e[7]=n("h2",null,"批量翻译",-1)),n("div",oe,[t(k,{content:"刷新页面",placement:"top"},{default:l(()=>[t(c,{type:"primary",icon:"Refresh",circle:"",onClick:e[0]||(e[0]=()=>{u.value=[],r(o).batchStatus=null})})]),_:1})])]),t(D,{class:"form-card",shadow:"hover"},{default:l(()=>[t(M,{model:p,"label-position":"top"},{default:l(()=>[t(x,{label:"目标语言"},{default:l(()=>[t(V,{modelValue:p.targetLanguage,"onUpdate:modelValue":e[1]||(e[1]=s=>p.targetLanguage=s),placeholder:"请选择目标语言","allow-create":"",filterable:""},{default:l(()=>[(_(),b(I,null,N(C,s=>t(L,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"源语言 (可选，默认自动检测)"},{default:l(()=>[t(V,{modelValue:p.sourceLanguage,"onUpdate:modelValue":e[2]||(e[2]=s=>p.sourceLanguage=s),placeholder:"请选择源语言",clearable:"","allow-create":"",filterable:""},{default:l(()=>[(_(),b(I,null,N(C,s=>t(L,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(J,{modelValue:p.preserveFormatting,"onUpdate:modelValue":e[3]||(e[3]=s=>p.preserveFormatting=s)},{default:l(()=>e[8]||(e[8]=[d(" 保留原文格式 ")])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),n("div",{class:"upload-area",onDragover:U,onDrop:R},[n("input",{ref_key:"fileListRef",ref:v,type:"file",onChange:P,accept:".txt,.md,.docx,.csv,.xlsx,.pdf,.srt,.json",multiple:"",style:{display:"none"}},null,544),u.value.length===0?(_(),b("div",ne,[t(F,null,{default:l(()=>[t(r(Y))]),_:1}),e[10]||(e[10]=n("h3",null,"拖拽文件到此处或点击上传",-1)),e[11]||(e[11]=n("p",null,"支持的格式: TXT, Markdown, Word, CSV, Excel, PDF, SRT, JSON",-1)),e[12]||(e[12]=n("p",null,"支持批量上传多个文件",-1)),t(c,{type:"primary",onClick:e[4]||(e[4]=s=>{var g;return(g=v.value)==null?void 0:g.click()}),icon:"Plus"},{default:l(()=>e[9]||(e[9]=[d(" 选择文件 ")])),_:1})])):(_(),b("div",re,[n("div",ie,[n("h3",null,"已选择 "+f(u.value.length)+" 个文件（总计 "+f(E.value)+" MB）",1),t(c,{type:"primary",onClick:e[5]||(e[5]=s=>{var g;return(g=v.value)==null?void 0:g.click()}),icon:"Plus"},{default:l(()=>e[13]||(e[13]=[d(" 添加更多文件 ")])),_:1})]),t(q,{data:u.value,style:{width:"100%"},border:"",stripe:"","max-height":"300","header-cell-style":{backgroundColor:"#f5f7fa"}},{default:l(()=>[t(S,{label:"文件名",prop:"name","min-width":"280"},{default:l(({row:s})=>[n("div",ue,[t(F,null,{default:l(()=>[(_(),z(Z(A(s.name))))]),_:2},1024),t(k,{content:s.name,placement:"top",disabled:s.name.length<30},{default:l(()=>[n("span",ce,f(s.name),1)]),_:2},1032,["content","disabled"])])]),_:1}),t(S,{label:"大小",width:"120",align:"right"},{default:l(({row:s})=>[d(f((s.size/1024).toFixed(2))+" KB ",1)]),_:1}),t(S,{label:"操作",width:"80",align:"center"},{default:l(({$index:s})=>[t(k,{content:"移除文件",placement:"top"},{default:l(()=>[t(c,{type:"danger",size:"small",onClick:g=>$(s),icon:"Delete",circle:""},null,8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),n("div",de,[t(c,{onClick:w,icon:"DeleteFilled"},{default:l(()=>e[14]||(e[14]=[d("清空列表")])),_:1}),t(c,{type:"primary",onClick:j,icon:"Upload"},{default:l(()=>e[15]||(e[15]=[d("开始批量翻译")])),_:1})])]))],32),r(o).batchStatus?(_(),z(D,{key:0,class:"batch-status-card",shadow:"hover"},{header:l(()=>e[16]||(e[16]=[n("div",{class:"card-header"},[n("h3",null,"批量任务进度")],-1)])),default:l(()=>[t(K,{border:"",column:2},{default:l(()=>[t(h,{label:"任务ID"},{default:l(()=>[t(B,{size:"small"},{default:l(()=>[d(f(r(o).batchStatus.batchId),1)]),_:1})]),_:1}),t(h,{label:"状态"},{default:l(()=>[t(B,{type:r(o).batchStatus.status==="completed"?"success":r(o).batchStatus.status==="failed"?"danger":"warning"},{default:l(()=>[d(f(r(o).batchStatus.status),1)]),_:1},8,["type"])]),_:1}),t(h,{label:"总文件数"},{default:l(()=>[d(f(r(o).batchStatus.totalCount),1)]),_:1}),t(h,{label:"已完成"},{default:l(()=>[d(f(r(o).batchStatus.completedCount),1)]),_:1}),t(h,{label:"失败"},{default:l(()=>[d(f(r(o).batchStatus.failedCount),1)]),_:1})]),_:1}),n("div",pe,[t(W,{percentage:r(o).batchStatus.progress,status:r(o).batchStatus.status==="failed"?"exception":r(o).batchStatus.status==="completed"?"success":"","stroke-width":18},null,8,["percentage","status"])]),r(o).batchStatus.status==="completed"?(_(),b("div",fe,[t(c,{type:"success",onClick:e[6]||(e[6]=s=>r(o).downloadBatchResults(r(o).batchStatus.taskIds)),icon:"Download"},{default:l(()=>e[17]||(e[17]=[d(" 下载所有翻译结果 ")])),_:1})])):O("",!0)]),_:1})):O("",!0)])}}}),be=le(me,[["__scopeId","data-v-d37ab88f"]]);export{be as default};
