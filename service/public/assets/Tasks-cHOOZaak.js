const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OfficePreview-CZE8ctz6.js","assets/index-DPJx0n5h.js","assets/index-Agpj6zS6.css","assets/OfficePreview-BexZtA8v.css","assets/MarkdownPreview-9fVNgt1c.js","assets/MarkdownPreview-CPxy0VYL.css","assets/CsvPreview-D5o05EVP.js","assets/CsvPreview-wiTtDu4k.css","assets/JsonPreview-BB3OerR7.js","assets/JsonPreview-BALRVt9H.css","assets/SubtitlePreview-D0d-ysGG.js","assets/SubtitlePreview-DyeYqUme.css","assets/TextPreview-BsIo_fJX.js","assets/TextPreview-pWBHCSNY.css"])))=>i.map(i=>d[i]);
import{d as Z,s as b,t as j,r as f,w as t,a as c,o as u,n as m,D as ce,q as S,e,c as z,A as de,u as ne,l as ue,G as fe,z as d,E as v,H as B,I as V,_ as ae,m as _e,J as pe,K as ve,f as s,L as Y}from"./index-DPJx0n5h.js";const me=["innerHTML"],ge=["innerHTML"],he=Z({__name:"index",props:{content:String},setup(L){return(_,h)=>{const y=f("el-tooltip");return L.content?(u(),b(y,{key:0,placement:"top"},{content:t(()=>[c("div",{class:"tooltip-container",innerHTML:L.content},null,8,me)]),default:t(()=>[c("div",{class:"shenglue shenglue3",innerHTML:L.content},null,8,ge)]),_:1})):j("",!0)}}}),ye={class:"file-preview-container"},we={key:1,class:"loading-container"},be={key:2,class:"error-container"},ke=Z({__name:"FilePreview",setup(L,{expose:_}){const h=m(!0),y=m(""),x=B(()=>V(()=>import("./OfficePreview-CZE8ctz6.js"),__vite__mapDeps([0,1,2,3]))),M=B(()=>V(()=>import("./MarkdownPreview-9fVNgt1c.js"),__vite__mapDeps([4,1,2,5]))),J=B(()=>V(()=>import("./CsvPreview-D5o05EVP.js"),__vite__mapDeps([6,1,2,7]))),g=B(()=>V(()=>import("./JsonPreview-BB3OerR7.js"),__vite__mapDeps([8,1,2,9]))),$=B(()=>V(()=>import("./SubtitlePreview-D0d-ysGG.js"),__vite__mapDeps([10,1,2,11]))),K=B(()=>V(()=>import("./TextPreview-BsIo_fJX.js"),__vite__mapDeps([12,1,2,13]))),D=ce(null),I=S(()=>{var p;return((p=(T.value||"").split(".").pop())==null?void 0:p.toLowerCase())||""}),O=()=>{const r=I.value;return["docx","doc"].includes(r)||["xlsx","xls"].includes(r)||["pdf"].includes(r)?x:["md","markdown"].includes(r)?M:["csv"].includes(r)?J:["json"].includes(r)?g:["srt","vtt","ass","ssa"].includes(r)?$:["txt","log","ini","cfg","conf","xml","html","htm","js","ts","css","scss","less"].includes(r)?K:null},T=m(""),E=m(""),A=m(!1);return _({reset:async(r,p,k)=>{E.value=`${p} - ${k=="target"?"结果预览":"原文件预览"}`,A.value=!0,T.value=r;try{if(h.value=!0,!r)throw new Error("未提供文件URL");D.value=O(),D.value||(y.value=`不支持的文件类型: ${I.value}`),h.value=!1}catch(C){h.value=!1,y.value=C.message||"预览失败",v.error(y.value)}}}),(r,p)=>{const k=f("el-icon"),C=f("el-backtop"),F=f("el-dialog");return u(),b(F,{modelValue:A.value,"onUpdate:modelValue":p[0]||(p[0]=R=>A.value=R),fullscreen:"","destroy-on-close":"",center:"",title:E.value},{default:t(()=>[c("div",ye,[D.value?(u(),b(de(D.value),{key:0,fileUrl:T.value,fileType:I.value},null,8,["fileUrl","fileType"])):h.value?(u(),z("div",we,[e(k,{class:"loading"},{default:t(()=>[e(ne(ue))]),_:1}),p[1]||(p[1]=c("span",null,"正在加载文件预览...",-1))])):(u(),z("div",be,[e(k,null,{default:t(()=>[e(ne(fe))]),_:1}),c("span",null,d(y.value||`不支持的文件类型: ${I.value}`),1)]))]),e(C,{target:".el-dialog.is-fullscreen"})]),_:1},8,["modelValue","title"])}}}),Te=ae(ke,[["__scopeId","data-v-9fa6c3ab"]]),Ce={class:"tasks-container"},xe={class:"section-title"},$e={class:"header-actions"},De={key:0,class:"table-toolbar"},Ie={class:"batch-actions"},Ee={key:0,class:"table-toolbar"},Re={class:"batch-actions"},Pe={class:"line2"},Be={key:0,class:"table-toolbar"},Ve={class:"batch-actions"},ze={class:"line2"},Le=Z({__name:"Tasks",setup(L){const _=_e(),h=m(null);m([]);const y=m(null),x=m(null),M=m(null),J=m(!0),g=m([]),$=S(()=>g.value.length>0);pe(()=>{I(),D()});const K=()=>{h.value&&(window.clearInterval(h.value),h.value=null)},D=()=>{K(),J.value&&(h.value=window.setInterval(()=>{O()},5e3))},I=async()=>{await _.fetchAllTasks()},O=async()=>{const a=g.value.map(l=>l.id);await _.fetchAllTasks(),a.length!==0&&(await ve(),[y.value,x.value,M.value].forEach(l=>{if(!l)return;const o=l.data;o&&o.length>0&&o.forEach(P=>{a.includes(P.id)&&l.toggleRowSelection(P,!0)})}))},T=async a=>{try{await Y.confirm("确定要删除此任务吗？删除后将无法恢复。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _.deleteTask(a),v.success("删除成功")}catch(l){l!=="cancel"&&v.error("删除失败")}},E=async()=>{if(g.value.length===0){v.warning("请至少选择一个任务");return}try{await Y.confirm(`确定要删除选中的 ${g.value.length} 个任务吗？删除后将无法恢复。`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=g.value.map(l=>l.id);await _.batchDeleteTasks(a),v.success("批量删除成功"),g.value=[]}catch(a){a!=="cancel"&&v.error("批量删除失败")}},A=a=>{a.status==="completed"?_.downloadTranslation(a.id):v.warning("翻译结果尚未准备好")},ee=()=>{if(g.value.length===0){v.warning("请至少选择一个已完成的任务");return}const a=g.value.filter(o=>o.status==="completed");if(a.length===0){v.warning("选中的任务中没有已完成的任务");return}const l=a.map(o=>o.id);_.downloadBatchResults(l)},r=a=>{g.value=a},p={pending:"info",processing:"warning",completed:"success",failed:"danger"},k={pending:"等待中",processing:"处理中",completed:"已完成",failed:"失败"},C=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(2)+" KB":(a/(1024*1024)).toFixed(2)+" MB",F=a=>new Date(a).toLocaleString(),R=S(()=>_.tasks.filter(a=>a.status==="processing"||a.status==="pending")),H=S(()=>_.tasks.filter(a=>a.status==="completed")),N=S(()=>_.tasks.filter(a=>a.status==="failed")),se=async()=>{try{await O(),v.success("任务列表已更新")}catch{v.error("获取任务列表失败")}},te=async a=>{try{await Y.confirm("确定要重新翻译此任务吗？如果已经有翻译结果，将会被删除。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _.retryTranslation(a),v.success("任务已加入重新翻译队列")}catch(l){l!=="cancel"&&v.error("重新翻译失败")}},q=m(),le="",U=async(a,l)=>{l=="target"?q.value.reset(`${le}/${a.outputPath.replace(/\\\\/,"/")}`,a.fileInfo.originalname,l):q.value.reset(`${le}/uploads/${a.fileInfo.filename}`,a.fileInfo.originalname,l)};return(a,l)=>{const o=f("el-button"),P=f("el-empty"),i=f("el-table-column"),G=f("el-tooltip"),oe=f("el-progress"),Q=f("el-tag"),W=f("el-table"),X=f("el-tab-pane"),ie=f("el-tabs"),re=f("el-card");return u(),z("div",Ce,[c("div",xe,[l[1]||(l[1]=c("h2",null,"任务管理",-1)),c("div",$e,[e(o,{type:"primary",onClick:se,icon:"Refresh"},{default:t(()=>l[0]||(l[0]=[s(" 刷新 ")])),_:1})])]),e(re,{class:"card-container",shadow:"hover"},{default:t(()=>[e(ie,{type:"border-card",class:"tasks-tabs"},{default:t(()=>[e(X,{label:`进行中 (${R.value.length})`},{default:t(()=>[R.value.length>0?(u(),z("div",De,[c("div",Ie,[e(o,{type:"danger",size:"small",icon:"Delete",disabled:!$.value,onClick:E},{default:t(()=>l[2]||(l[2]=[s(" 批量删除 ")])),_:1},8,["disabled"])])])):j("",!0),R.value.length===0?(u(),b(P,{key:1,description:"暂无进行中的任务"})):(u(),b(W,{key:2,ref_key:"processingTable",ref:y,data:R.value,style:{width:"100%"},border:"",stripe:"","max-height":"530",onSelectionChange:r},{default:t(()=>[e(i,{type:"selection",width:"55"}),e(i,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:t(({row:n})=>[e(G,{content:n.id,placement:"top"},{default:t(()=>[c("span",null,d(n.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),e(i,{label:"文件名","min-width":"200"},{default:t(({row:n})=>[s(d(n.fileInfo.originalname),1)]),_:1}),e(i,{label:"大小",width:"100"},{default:t(({row:n})=>[s(d(C(n.fileInfo.size)),1)]),_:1}),e(i,{label:"进度",width:"200"},{default:t(({row:n})=>[e(oe,{percentage:n.progress,status:n.status==="failed"?"exception":void 0},null,8,["percentage","status"])]),_:1}),e(i,{label:"状态",width:"100"},{default:t(({row:n})=>[e(Q,{type:p[n.status]},{default:t(()=>[s(d(k[n.status]),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"创建时间",width:"180"},{default:t(({row:n})=>[s(d(F(n.createdAt)),1)]),_:1}),e(i,{label:"操作",width:"166",fixed:"right"},{default:t(({row:n})=>[e(o,{type:"primary",size:"small",onClick:w=>U(n,"source"),icon:"View"},{default:t(()=>l[3]||(l[3]=[s(" 原文 ")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:w=>T(n.id),icon:"Delete"},{default:t(()=>l[4]||(l[4]=[s(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"]),e(X,{label:`已完成 (${H.value.length})`},{default:t(()=>[H.value.length>0?(u(),z("div",Ee,[c("div",Re,[e(o,{type:"primary",size:"small",icon:"Download",disabled:!$.value,onClick:ee},{default:t(()=>l[5]||(l[5]=[s(" 批量下载 ")])),_:1},8,["disabled"]),e(o,{type:"danger",size:"small",icon:"Delete",disabled:!$.value,onClick:E},{default:t(()=>l[6]||(l[6]=[s(" 批量删除 ")])),_:1},8,["disabled"])])])):j("",!0),H.value.length===0?(u(),b(P,{key:1,description:"暂无已完成的任务"})):(u(),b(W,{key:2,ref_key:"completedTable",ref:x,data:H.value,style:{width:"100%"},border:"",stripe:"","max-height":"530",onSelectionChange:r},{default:t(()=>[e(i,{type:"selection",width:"55"}),e(i,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:t(({row:n})=>[e(G,{content:n.id,placement:"top"},{default:t(()=>[c("span",null,d(n.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),e(i,{label:"文件名","min-width":"200"},{default:t(({row:n})=>[s(d(n.fileInfo.originalname),1)]),_:1}),e(i,{label:"大小",width:"100"},{default:t(({row:n})=>[s(d(C(n.fileInfo.size)),1)]),_:1}),e(i,{label:"状态",width:"100"},{default:t(({row:n})=>[e(Q,{type:p[n.status]},{default:t(()=>[s(d(k[n.status]),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"完成时间",width:"160"},{default:t(({row:n})=>[s(d(F(n.updatedAt)),1)]),_:1}),e(i,{label:"操作",width:"244"},{default:t(({row:n})=>[e(o,{type:"primary",size:"small",onClick:w=>U(n,"source"),icon:"View"},{default:t(()=>l[7]||(l[7]=[s(" 原文 ")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:w=>U(n,"target"),icon:"View"},{default:t(()=>l[8]||(l[8]=[s(" 结果 ")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:w=>A(n),icon:"Download"},{default:t(()=>l[9]||(l[9]=[s(" 下载 ")])),_:2},1032,["onClick"]),c("p",Pe,[e(o,{type:"warning",size:"small",onClick:w=>te(n.id),icon:"Refresh"},{default:t(()=>l[10]||(l[10]=[s(" 重翻 ")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:w=>T(n.id),icon:"Delete"},{default:t(()=>l[11]||(l[11]=[s(" 删除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"]),e(X,{label:`失败 (${N.value.length})`},{default:t(()=>[N.value.length>0?(u(),z("div",Be,[c("div",Ve,[e(o,{type:"danger",size:"small",icon:"Delete",disabled:!$.value,onClick:E},{default:t(()=>l[12]||(l[12]=[s(" 批量删除 ")])),_:1},8,["disabled"])])])):j("",!0),N.value.length===0?(u(),b(P,{key:1,description:"暂无失败的任务"})):(u(),b(W,{key:2,ref_key:"failedTable",ref:M,data:N.value,style:{width:"100%"},border:"",stripe:"","max-height":"530",onSelectionChange:r},{default:t(()=>[e(i,{type:"selection",width:"55"}),e(i,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:t(({row:n})=>[e(G,{content:n.id,placement:"top"},{default:t(()=>[c("span",null,d(n.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),e(i,{label:"文件名","min-width":"200"},{default:t(({row:n})=>[s(d(n.fileInfo.originalname),1)]),_:1}),e(i,{label:"大小",width:"100"},{default:t(({row:n})=>[s(d(C(n.fileInfo.size)),1)]),_:1}),e(i,{label:"状态",width:"100"},{default:t(({row:n})=>[e(Q,{type:p[n.status]},{default:t(()=>[s(d(k[n.status]),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"错误信息","min-width":"200"},{default:t(({row:n})=>[e(he,{content:n.error||"未知错误"},null,8,["content"])]),_:1}),e(i,{label:"操作",width:"166"},{default:t(({row:n})=>[e(o,{type:"primary",size:"small",onClick:w=>U(n,"source"),icon:"View"},{default:t(()=>l[13]||(l[13]=[s(" 原文 ")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:w=>T(n.id),icon:"Delete"},{default:t(()=>l[14]||(l[14]=[s(" 删除 ")])),_:2},1032,["onClick"]),c("p",ze,[e(o,{type:"warning",size:"small",onClick:w=>te(n.id),icon:"Refresh"},{default:t(()=>l[15]||(l[15]=[s(" 重翻 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"])]),_:1})]),_:1}),e(Te,{ref_key:"previewRef",ref:q},null,512)])}}}),Se=ae(Le,[["__scopeId","data-v-0d161c31"]]);export{Se as default};
