import{d as W,n as m,q as $,J as z,E as A,r as G,c as o,o as l,t as y,e as h,a as c,w as k,u as S,l as J,G as R,z as _,F as I,x as N,s as H,ao as K,ap as Q,ac as X,_ as Y}from"./index-DPJx0n5h.js";const Z={class:"subtitle-preview-container"},tt={key:0,class:"loading-container"},et={key:1,class:"error-container"},st={key:2,class:"subtitle-content"},nt={key:0,class:"subtitle-toolbar"},at={class:"subtitle-list"},rt={class:"subtitle-index"},lt={class:"subtitle-time"},ot={class:"subtitle-text"},it=W({__name:"SubtitlePreview",props:{fileUrl:{type:String,required:!0}},setup(B){const T=B,u=m(!0),d=m(""),b=m([]),p=m(""),v=m([]),C=$(()=>v.value.length>1),L=$(()=>!p.value||!C.value?b.value:b.value.filter(e=>e.language===p.value)),E=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60),a=Math.floor(e%1*1e3);return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")},${String(a).padStart(3,"0")}`},w=e=>{const t=e.replace(",",".").split(":"),n=parseInt(t[0])||0,s=parseInt(t[1])||0,a=t[2].split("."),f=parseInt(a[0])||0,r=parseInt(a[1])||0;return n*3600+s*60+f+r/1e3},P=e=>{const t=[],n=e.trim().split(/\r?\n\r?\n/);for(const s of n){const a=s.split(/\r?\n/);if(a.length<3)continue;const f=parseInt(a[0].trim())||t.length+1,r=a[1].match(/(\d{2}:\d{2}:\d{2}[,\.]\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2}[,\.]\d{3})/);if(!r)continue;const i=w(r[1]),x=w(r[2]),g=a.slice(2).join(`
`);t.push({index:f,start:i,end:x,text:g})}return t},U=e=>{const t=[],s=e.replace(/^WEBVTT.*?(\r?\n\r?\n)/is,"").trim().split(/\r?\n\r?\n/);let a=1;for(const f of s){const r=f.split(/\r?\n/);if(r.length<2)continue;let i=0,x=a;if(r[0].match(/^\d+$/))x=parseInt(r[0].trim()),i=1;else if(r[0].startsWith("NOTE"))continue;const g=r[i].match(/(\d{2}:\d{2}:\d{2}[,\.]\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2}[,\.]\d{3})/);if(!g)continue;const q=w(g[1]),F=w(g[2]);let M;const V=r[i].match(/lang:(\w+)/);V&&(M=V[1]);const O=r.slice(i+1).join(`
`);t.push({index:x,start:q,end:F,text:O,language:M}),a++}return t},D=async()=>{try{return(await X.get(T.fileUrl,{responseType:"text"})).data}catch(e){throw new Error(e.message||"获取字幕内容失败")}},j=async(e,t)=>{try{let n=[];if(console.log("解析字幕格式:",t),t==="srt")n=P(e);else if(t==="vtt")n=U(e);else throw new Error(`不支持的字幕格式: ${t}`);console.log("解析结果:",n.length,"条字幕");const s=new Set;return n.forEach(a=>{a.language&&s.add(a.language)}),v.value=Array.from(s),v.value.length>0&&(p.value=v.value[0]),n}catch(n){throw new Error(`字幕解析失败: ${n.message}`)}};return z(async()=>{var e;try{u.value=!0;const t=((e=T.fileUrl.split(".").pop())==null?void 0:e.toLowerCase())||"";if(!["srt","vtt"].includes(t))throw new Error(`不支持的字幕格式: ${t}`);const n=await D();b.value=await j(n,t),u.value=!1}catch(t){u.value=!1,d.value=t.message||"字幕预览失败",A.error(d.value)}}),(e,t)=>{const n=G("el-icon");return l(),o("div",Z,[u.value?(l(),o("div",tt,[h(n,{class:"loading"},{default:k(()=>[h(S(J))]),_:1}),t[1]||(t[1]=c("span",null,"正在加载字幕...",-1))])):y("",!0),d.value?(l(),o("div",et,[h(n,null,{default:k(()=>[h(S(R))]),_:1}),c("span",null,_(d.value),1)])):y("",!0),!u.value&&!d.value?(l(),o("div",st,[b.value.length>0&&C.value?(l(),o("div",nt,[h(S(Q),{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),placeholder:"选择语言"},{default:k(()=>[(l(!0),o(I,null,N(v.value,(s,a)=>(l(),H(S(K),{key:a,label:s||"默认",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):y("",!0),c("div",at,[(l(!0),o(I,null,N(L.value,(s,a)=>(l(),o("div",{key:a,class:"subtitle-item"},[c("div",rt,"#"+_(s.index),1),c("div",lt,_(E(s.start))+" → "+_(E(s.end)),1),c("div",ot,_(s.text),1)]))),128))])])):y("",!0)])}}}),ut=Y(it,[["__scopeId","data-v-af36c2cf"]]);export{ut as default};
