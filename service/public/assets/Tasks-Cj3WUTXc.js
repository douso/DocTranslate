import{d as J,s as m,t as I,r as u,w as l,a as p,o as f,m as le,n as h,q as D,D as ae,G as ne,c as B,e as t,f as o,z as d,H as V,E as c,_ as se}from"./index-Bz0q8fqb.js";const oe=["innerHTML"],ie=["innerHTML"],de=J({__name:"index",props:{content:String},setup(y){return(r,b)=>{const w=u("el-tooltip");return y.content?(f(),m(w,{key:0,placement:"top"},{content:l(()=>[p("div",{class:"tooltip-container",innerHTML:y.content},null,8,oe)]),default:l(()=>[p("div",{class:"shenglue shenglue3",innerHTML:y.content},null,8,ie)]),_:1})):I("",!0)}}}),ce={class:"tasks-container"},re={class:"section-title"},ue={class:"header-actions"},fe={key:0,class:"table-toolbar"},pe={class:"batch-actions"},_e={key:0,class:"table-toolbar"},he={class:"batch-actions"},me={key:0,class:"table-toolbar"},ge={class:"batch-actions"},be=J({__name:"Tasks",setup(y){const r=le(),b=h(null);h([]);const w=h(null),F=h(null),q=h(null),O=h(!0),_=h([]),k=D(()=>_.value.length>0);ae(()=>{U(),Q()});const P=()=>{b.value&&(window.clearInterval(b.value),b.value=null)},Q=()=>{P(),O.value&&(b.value=window.setInterval(()=>{G()},5e3))},U=async()=>{await r.fetchAllTasks()},G=async()=>{const n=_.value.map(a=>a.id);await r.fetchAllTasks(),n.length!==0&&(await ne(),[w.value,F.value,q.value].forEach(a=>{if(!a)return;const i=a.data;i&&i.length>0&&i.forEach(g=>{n.includes(g.id)&&a.toggleRowSelection(g,!0)})}))},S=async n=>{try{await V.confirm("确定要删除此任务吗？删除后将无法恢复。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await r.deleteTask(n),c.success("删除成功")}catch(a){a!=="cancel"&&c.error("删除失败")}},$=async()=>{if(_.value.length===0){c.warning("请至少选择一个任务");return}try{await V.confirm(`确定要删除选中的 ${_.value.length} 个任务吗？删除后将无法恢复。`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const n=_.value.map(a=>a.id);await r.batchDeleteTasks(n),c.success("批量删除成功"),_.value=[]}catch(n){n!=="cancel"&&c.error("批量删除失败")}},W=n=>{n.status==="completed"?r.downloadTranslation(n.id):c.warning("翻译结果尚未准备好")},X=()=>{if(_.value.length===0){c.warning("请至少选择一个已完成的任务");return}const n=_.value.filter(i=>i.status==="completed");if(n.length===0){c.warning("选中的任务中没有已完成的任务");return}const a=n.map(i=>i.id);r.downloadBatchResults(a)},z=n=>{_.value=n},M={pending:"info",processing:"warning",completed:"success",failed:"danger"},R={pending:"等待中",processing:"处理中",completed:"已完成",failed:"失败"},A=n=>n<1024?n+" B":n<1024*1024?(n/1024).toFixed(2)+" KB":(n/(1024*1024)).toFixed(2)+" MB",K=n=>new Date(n).toLocaleString(),T=D(()=>r.tasks.filter(n=>n.status==="processing"||n.status==="pending")),C=D(()=>r.tasks.filter(n=>n.status==="completed")),x=D(()=>r.tasks.filter(n=>n.status==="failed")),Y=async()=>{try{await G(),c.success("任务列表已更新")}catch{c.error("获取任务列表失败")}},j=async n=>{try{await V.confirm("确定要重新翻译此任务吗？如果已经有翻译结果，将会被删除。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await r.retryTranslation(n),c.success("任务已加入重新翻译队列")}catch(a){a!=="cancel"&&c.error("重新翻译失败")}};return(n,a)=>{const i=u("el-button"),g=u("el-empty"),s=u("el-table-column"),E=u("el-tooltip"),L=u("el-tag"),Z=u("el-progress"),H=u("el-table"),N=u("el-tab-pane"),ee=u("el-tabs"),te=u("el-card");return f(),B("div",ce,[p("div",re,[a[1]||(a[1]=p("h2",null,"任务管理",-1)),p("div",ue,[t(i,{type:"primary",onClick:Y,icon:"Refresh"},{default:l(()=>a[0]||(a[0]=[o(" 刷新 ")])),_:1})])]),t(te,{class:"card-container",shadow:"hover"},{default:l(()=>[t(ee,{type:"border-card",class:"tasks-tabs"},{default:l(()=>[t(N,{label:`进行中 (${T.value.length})`},{default:l(()=>[T.value.length>0?(f(),B("div",fe,[p("div",pe,[t(i,{type:"danger",size:"small",icon:"Delete",disabled:!k.value,onClick:$},{default:l(()=>a[2]||(a[2]=[o(" 批量删除 ")])),_:1},8,["disabled"])])])):I("",!0),T.value.length===0?(f(),m(g,{key:1,description:"暂无进行中的任务"})):(f(),m(H,{key:2,ref_key:"processingTable",ref:w,data:T.value,style:{width:"100%"},border:"",stripe:"","max-height":"500",onSelectionChange:z},{default:l(()=>[t(s,{type:"selection",width:"55"}),t(s,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:l(({row:e})=>[t(E,{content:e.id,placement:"top"},{default:l(()=>[p("span",null,d(e.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),t(s,{label:"文件名","min-width":"200"},{default:l(({row:e})=>[o(d(e.fileInfo.originalname),1)]),_:1}),t(s,{label:"大小",width:"100"},{default:l(({row:e})=>[o(d(A(e.fileInfo.size)),1)]),_:1}),t(s,{label:"状态",width:"100"},{default:l(({row:e})=>[t(L,{type:M[e.status]},{default:l(()=>[o(d(R[e.status]),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"进度",width:"200"},{default:l(({row:e})=>[t(Z,{percentage:e.progress,status:e.status==="failed"?"exception":void 0},null,8,["percentage","status"])]),_:1}),t(s,{label:"创建时间",width:"180"},{default:l(({row:e})=>[o(d(K(e.createdAt)),1)]),_:1}),t(s,{label:"操作",width:"100",fixed:"right"},{default:l(({row:e})=>[t(i,{type:"danger",size:"small",onClick:v=>S(e.id),icon:"Delete"},{default:l(()=>a[3]||(a[3]=[o(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"]),t(N,{label:`已完成 (${C.value.length})`},{default:l(()=>[C.value.length>0?(f(),B("div",_e,[p("div",he,[t(i,{type:"primary",size:"small",icon:"Download",disabled:!k.value,onClick:X},{default:l(()=>a[4]||(a[4]=[o(" 批量下载 ")])),_:1},8,["disabled"]),t(i,{type:"danger",size:"small",icon:"Delete",disabled:!k.value,onClick:$},{default:l(()=>a[5]||(a[5]=[o(" 批量删除 ")])),_:1},8,["disabled"])])])):I("",!0),C.value.length===0?(f(),m(g,{key:1,description:"暂无已完成的任务"})):(f(),m(H,{key:2,ref_key:"completedTable",ref:F,data:C.value,style:{width:"100%"},border:"",stripe:"","max-height":"500",onSelectionChange:z},{default:l(()=>[t(s,{type:"selection",width:"55"}),t(s,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:l(({row:e})=>[t(E,{content:e.id,placement:"top"},{default:l(()=>[p("span",null,d(e.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),t(s,{label:"文件名","min-width":"200"},{default:l(({row:e})=>[o(d(e.fileInfo.originalname),1)]),_:1}),t(s,{label:"大小",width:"100"},{default:l(({row:e})=>[o(d(A(e.fileInfo.size)),1)]),_:1}),t(s,{label:"状态",width:"100"},{default:l(({row:e})=>[t(L,{type:M[e.status]},{default:l(()=>[o(d(R[e.status]),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"完成时间",width:"180"},{default:l(({row:e})=>[o(d(K(e.updatedAt)),1)]),_:1}),t(s,{label:"操作",width:"270",fixed:"right"},{default:l(({row:e})=>[t(i,{type:"primary",size:"small",onClick:v=>W(e),icon:"Download"},{default:l(()=>a[6]||(a[6]=[o(" 下载 ")])),_:2},1032,["onClick"]),t(i,{type:"warning",size:"small",onClick:v=>j(e.id),icon:"Refresh"},{default:l(()=>a[7]||(a[7]=[o(" 重新翻译 ")])),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:v=>S(e.id),icon:"Delete"},{default:l(()=>a[8]||(a[8]=[o(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"]),t(N,{label:`失败 (${x.value.length})`},{default:l(()=>[x.value.length>0?(f(),B("div",me,[p("div",ge,[t(i,{type:"danger",size:"small",icon:"Delete",disabled:!k.value,onClick:$},{default:l(()=>a[9]||(a[9]=[o(" 批量删除 ")])),_:1},8,["disabled"])])])):I("",!0),x.value.length===0?(f(),m(g,{key:1,description:"暂无失败的任务"})):(f(),m(H,{key:2,ref_key:"failedTable",ref:q,data:x.value,style:{width:"100%"},border:"",stripe:"","max-height":"500",onSelectionChange:z},{default:l(()=>[t(s,{type:"selection",width:"55"}),t(s,{label:"任务ID",width:"240","show-overflow-tooltip":""},{default:l(({row:e})=>[t(E,{content:e.id,placement:"top"},{default:l(()=>[p("span",null,d(e.id.substring(0,16))+"...",1)]),_:2},1032,["content"])]),_:1}),t(s,{label:"文件名","min-width":"200"},{default:l(({row:e})=>[o(d(e.fileInfo.originalname),1)]),_:1}),t(s,{label:"大小",width:"100"},{default:l(({row:e})=>[o(d(A(e.fileInfo.size)),1)]),_:1}),t(s,{label:"状态",width:"100"},{default:l(({row:e})=>[t(L,{type:M[e.status]},{default:l(()=>[o(d(R[e.status]),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"错误信息","min-width":"200"},{default:l(({row:e})=>[t(de,{content:e.error||"未知错误"},null,8,["content"])]),_:1}),t(s,{label:"操作",width:"190",fixed:"right"},{default:l(({row:e})=>[t(i,{type:"warning",size:"small",onClick:v=>j(e.id),icon:"Refresh"},{default:l(()=>a[10]||(a[10]=[o(" 重新翻译 ")])),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:v=>S(e.id),icon:"Delete"},{default:l(()=>a[11]||(a[11]=[o(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["label"])]),_:1})]),_:1})])}}}),ye=se(be,[["__scopeId","data-v-6f5e8abb"]]);export{ye as default};
